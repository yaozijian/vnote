# 1 第一课

## 1 宏

```rust
fn main() {
    println!("Hello, world!");
}
```

* `println!`中的感叹号表示宏
* 宏的参数在编译时进行检查，如果非法，编译出错；而不是在运行时检查

## 2 显示与特性

```rust
struct Person {
    name: String,
    age: u32,
}

fn main() {
    let alice = Person {
        name: String::from("Alice"),
        age: 30,
    };
    println!("Person: {}", alice);
}
```

* 输出格式与特性对应，通常的、不带输出格式指示的`{}`要求参数实现`std::fmt::Display`特性
* 其他输出格式见[字符串格式化](../字符串格式化.md) 4.2 节
* `std::fmt::Display`特性要求一个`fmt`方法，签名如下：

```rust
fn fmt(&Self, f: &mut std::fmt::Formatter) -> std::fmt::Result
```

* `Self`代表要为其实现方法的当前类型
* `&`表示引用类型，而不是所有权类型
* `&mut`表示可变引用类型
* `->`指示返回类型
* Rust没有运行时异常，而是直接返回错误，几乎所有代码使用`Result`来表示错误，这比基于异常的语言更明确。
   * Rust有`panic`的概念，这与运行时异常的行为类似。但是：
   1.  不建议使用`panic`返回通常的错误，`panic`是为完全异常的失败（如逻辑错误）准备的
   2. `panic`通常是不可恢复的，会终止当前线程（可以使用`std::panic::catch_unwind()`函数恢复`panic`，但是通常不建议使用）

## 3 分号

```rust
impl std::fmt::Display for Person{
    fn fmt(&self, f: &mut std::fmt::Formatter) -> std::fmt::Result{
        write!(f, "{} ({} years old)", self.name, self.age)//注意：这里没有分号
    }
}
```

* `&self`是`self: &Self`的语法糖
* Rust是基于表达式的语言：函数/方法通常不需要`return`，最后一个生成的值会作为函数/方法的返回值；`return`仅用在早期返回的地方
* 注意分号，这是很容易混淆的地方
   * 没有分号：表达式的值作为返回值
   * 添加分号：表达式成为一个语句，语句的值为`()`

## 4 数值类型

```rust
fn main() {
    let val: i32 = 42;
    printer(val);
    printer(val);
}

// i32 实现了 Copy 特性，作为参数传递时，自动复制值
fn printer(val: i32) {
    println!("The value is: {}", val);
}
```

```rust
fn main() {
    let val: String = String::from("Hello, World!");
    // String 没有实现 Copy 特性,作为参数传递时,无法自动复制值,而使用所有权传递
    // 第一次作为参数传递后,所有权已经转移,val已经失效;第二次使用val将出现编译错误
    printer(val);
    printer(val);
}

fn printer(val: String) {
    println!("The value is: {}", val);
}
```

### 4.1 使用引用

```rust
fn main() {
    let val: String = String::from("Hello, World!");
    printer(&val);
    printer(&val);
}

fn printer(val: &String) {
    println!("The value is: {}", val);
}
```

### 4.2 使用`clone`

```rust
fn main() {
    let val: String = String::from("Hello, World!");
    printer(val.clone());
    printer(val.clone());
}

fn printer(val: String) {
    println!("The value is: {}", val);
}
```

## 5 输出数值

### 5.1 `loop`

```rust
fn main() {
    let mut i = 1;
    loop {
        println!("i == {}", i);
        if i >= 10 {
            break;
        } else {
            i += 1;
        }
    }
}
```

### 5.2 `while`

```rust
fn main() {
    let mut i = 1;
    while i <= 10 {
        println!("i == {}", i);
        i += 1;
    }
}
```

### 5.3 `for`

```rust
fn main() {
    for i in 1..11 {
        println!("i == {}", i);
    }
}
```

## 6 练习

```rust
fn main() {
    for x in 1..101{
        let f = x % 3 == 0;
        let b = x % 5 == 0;
        if f && b{
            println!("fizzbuzz")
        }else if f{
            println!("fizz")
        }else if b{
            println!("buzz")
        }else{
            println!("{}",x)
        }
    }
}
```

```rust
fn main() {
    for i in 1..101 {
        match (i % 3, i % 5) {
            (0, 0) => println!("fizzbuzz"),
            (0, _) => println!("fizz"),
            (_, 0) => println!("buzz"),
            (_, _) => println!("{}", i),
        }
    }
}
```
